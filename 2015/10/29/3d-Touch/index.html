<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="iOS," />





  <link rel="alternate" href="/atom.xml" title="VicoV的博客" type="application/atom+xml" />






<meta name="description" content="很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&amp;gt;_&amp;lt;)。咳咳，趁着发呆时间赶紧来写一篇…demo请戳这里">
<meta name="keywords" content="iOS">
<meta property="og:type" content="article">
<meta property="og:title" content="手把手教你如何实现3d-Touch">
<meta property="og:url" content="http://vicowang.github.io/2015/10/29/3d-Touch/index.html">
<meta property="og:site_name" content="VicoV的博客">
<meta property="og:description" content="很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&amp;gt;_&amp;lt;)。咳咳，趁着发呆时间赶紧来写一篇…demo请戳这里">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029104541512.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029110028849.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029110624536.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029112319649.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029112659823.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029113210112.jpg">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029140226239.gif">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029141318865.gif">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029155243726.gif">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029160817411.gif">
<meta property="og:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029161500146.jpg">
<meta property="og:updated_time" content="2018-09-12T10:08:28.777Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="手把手教你如何实现3d-Touch">
<meta name="twitter:description" content="很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&amp;gt;_&amp;lt;)。咳咳，趁着发呆时间赶紧来写一篇…demo请戳这里">
<meta name="twitter:image" content="http://vicowang.github.io/2015/10/29/3d-Touch/20151029104541512.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://vicowang.github.io/2015/10/29/3d-Touch/"/>





  <title>手把手教你如何实现3d-Touch | VicoV的博客</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <!-- 这里添加github -->
    <a href="https://github.com/VicoWang" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">VicoV的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">无风自动</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://vicowang.github.io/2015/10/29/3d-Touch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wangkun">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/myheader.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="VicoV的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">手把手教你如何实现3d-Touch</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-10-29T16:19:05+08:00">
                2015-10-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2015/10/29/3d-Touch/" class="leancloud_visitors" data-flag-title="手把手教你如何实现3d-Touch">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">热度&#58;</span>
               
                 <!-- <span class="leancloud-visitors-count"></span> -->
                 <span id="busuanzi_value_page_pv"></span>
                 <span>°C</span>
             </span>
          

          

          <!-- 阅读次数  -->
          <!--  -->
         

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  1.6k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  6
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>很久之前就想写一篇关于3D Touch的博客，因为各种原因一直到现在才开始写(其实就是懒&gt;_&lt;)。咳咳，趁着发呆时间赶紧来写一篇…<a href="https://github.com/VicoWang/3D-Touch" target="_blank" rel="noopener">demo请戳这里</a></p>
<a id="more"></a>
<hr>
<p>3D Touch分为以下三大模块：<br>1.Home Screen Quick Actions<br>2.Peek and Pop<br>3.UITouch</p>
<hr>
<h2 id="1-Home-Screen-Quick-Actions"><a href="#1-Home-Screen-Quick-Actions" class="headerlink" title="1. Home  Screen Quick Actions"></a>1. Home  Screen Quick Actions</h2><p>重按主界面应用图标后弹出的快捷菜单，例如重按微信会出现这样的效果。<br><img src="/2015/10/29/3d-Touch/20151029104541512.jpg"><br>实现Quick Actions分为两种：静态和动态。</p>
<h5 id="1-1-Static（静态）Quick-Actions"><a href="#1-1-Static（静态）Quick-Actions" class="headerlink" title="1.1 Static（静态）Quick Actions"></a>1.1 Static（静态）Quick Actions</h5><p>Static Quick Actions只需要我们在项目的info.plist文件中配置，在用户安装程序后就可以使用。<br>配置Static Quick Actions只需要在info.plist文件中添加如下键值。</p>
<p>1.1.1 必填项（下面两个键值是必须设置的）:<br>UIApplicationShortcutItemType 这个键值设置一个快捷通道类型的字符串<br>UIApplicationShortcutItemTitle   这个键值设置标签的标题<br>1.1.2 选填项（下面这些键值不是必须设置的）：<br>UIApplicationShortcutItemSubtitle    设置标签的副标题<br>UIApplicationShortcutItemIconType 设置标签Icon类型<br>UIApplicationShortcutItemIconFile   设置标签的Icon文件<br>UIApplicationShortcutItemUserInfo  设置信息字典(用于传值)<br><img src="/2015/10/29/3d-Touch/20151029110028849.jpg"><br>如图配置好info.plist文件之后，运行程序，真机上测试效果如下：<br><img src="/2015/10/29/3d-Touch/20151029110624536.jpg"></p>
<h5 id="1-2-Dynamic（动态）-Quick-Actions"><a href="#1-2-Dynamic（动态）-Quick-Actions" class="headerlink" title="1.2 Dynamic（动态） Quick Actions"></a>1.2 Dynamic（动态） Quick Actions</h5><p>Dynamic Quick Actions是我们在程序中通过代码添加，与之相关的类主要有3个：<br>UIApplicationShortcutItem 创建3DTouch action的类<br>UIMutableApplicationShortcutItem 创建可变的3DTouch action的类<br>UIApplicationShortcutIcon 创建标签中图片icon的类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">UIApplicationShortcutIcon *icon1 = [UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeInvitation];</span><br><span class="line">UIMutableApplicationShortcutItem *item1 = [[UIMutableApplicationShortcutItem alloc]initWithType:@&quot;1&quot; localizedTitle:@&quot;么么哒&quot;];</span><br><span class="line">item1.icon = icon1;</span><br><span class="line"></span><br><span class="line">UIApplicationShortcutIcon *icon2 = [UIApplicationShortcutIcon iconWithType:UIApplicationShortcutIconTypeContact];</span><br><span class="line">UIApplicationShortcutItem *item2 = [[UIApplicationShortcutItem alloc]initWithType:@&quot;2&quot; localizedTitle:@&quot;萌萌哒&quot; localizedSubtitle:@&quot;看这里是不是想到了tableView&quot; icon:icon2 userInfo:nil</span><br><span class="line">];</span><br><span class="line">application.shortcutItems = @[item1,item2];</span><br></pre></td></tr></table></figure>
<p>我在application:didFinishLaunchingWithOptions:方法里面添加了以上代码，运行程序，真机测试的效果如下:<br><img src="/2015/10/29/3d-Touch/20151029112319649.jpg"><br>上述代码里面设置的icon不是UIImage，而是一个叫UIApplicationShortcutIcon的类。<br><img src="/2015/10/29/3d-Touch/20151029112659823.jpg"><br>API很简单吧~值得注意的是官方API里面的这句话：</p>
<blockquote>
<p>Icons should be square, single color, and 35x35 points, as shown in these template files and as described in Template Images in UIKit User Interface Catalog and in iOS Human Interface Guidelines.</p>
</blockquote>
<h5 id="1-3-Actions-被点击后的响应"><a href="#1-3-Actions-被点击后的响应" class="headerlink" title="1.3 Actions 被点击后的响应"></a>1.3 Actions 被点击后的响应</h5><p>类似推送，当我们点击Actions进入应用程序时，也可以进行一些操作，我们可以发现，在application中增加了这样一个方法：<br><img src="/2015/10/29/3d-Touch/20151029113210112.jpg"><br>当我们通过点击Actions进入app时，就会在appdelegate中调用这样一个回调，我们可以获取shortcutItem的信息进行相关逻辑操作。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">- (void)application:(UIApplication *)application performActionForShortcutItem:(UIApplicationShortcutItem *)shortcutItem completionHandler:(void (^)(BOOL))completionHandler &#123;</span><br><span class="line"></span><br><span class="line">if ([shortcutItem.localizedTitle isEqualToString:@&quot;New Message&quot;])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">UIAlertController *alertC = [UIAlertController alertControllerWithTitle:@&quot;老板&quot; message:@&quot;过来办公室，发妹子了&quot; preferredStyle:UIAlertControllerStyleAlert];</span><br><span class="line">UIAlertAction *action = [UIAlertAction actionWithTitle:@&quot;马上就来&quot; style:UIAlertActionStyleDefault handler:^(UIAlertAction * _Nonnull action) &#123;</span><br><span class="line">[alertC dismissViewControllerAnimated:YES completion:nil];</span><br><span class="line">&#125;];</span><br><span class="line">[alertC addAction:action];</span><br><span class="line">[self.window.rootViewController presentViewController:alertC animated:YES completion:nil];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">else if ([shortcutItem.localizedTitle isEqualToString:@&quot;Favorites&quot;])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">UINavigationController *naVC = (UINavigationController *)self.window.rootViewController;</span><br><span class="line">[naVC popToRootViewControllerAnimated:NO];</span><br><span class="line">ThirdViewController *thirdVC = [[ThirdViewController alloc]init];</span><br><span class="line">[naVC pushViewController:thirdVC animated:YES];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我在application: performActionForShortcutItem: completionHandler:方法里面写了这样一段代码，然后通过点击外界的New Message Action进入APP，就会走第一个if里面的语句，点击外界的Favorites Action进入APP，就会走第二个if里面的语句。真机测试效果如下:<br><img src="/2015/10/29/3d-Touch/20151029140226239.gif"></p>
<p>这里有一点需要注意：我们在app的入口函数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions;</span><br></pre></td></tr></table></figure></p>
<p>需要进行一下判断，在luanchOptions中有个UIApplicationLaunchOptionsShortcutItemKey这样一个键，通过它，我们可以区别是否是从标签进入的APP，如果是则处理结束逻辑后，返回NO，防止处理逻辑被反复回调。</p>
<hr>
<h2 id="2-Peek-and-Pop"><a href="#2-Peek-and-Pop" class="headerlink" title="2. Peek and Pop"></a>2. Peek and Pop</h2><p>Peek and Pop实际上就是基于重按的两个操作：peek 和pop。使用场景是item的详细信息不能完全展示出来时，通过3D Touch来预览以及跳转至详情页。苹果在这方面的封装很严实，我们不能修改动画的样式，只能修改preview(预览)窗的高度。什么？不知道具体的效果？好吧，先带你们看一下Peek and Pop的效果。<br><img src="/2015/10/29/3d-Touch/20151029141318865.gif"></p>
<p>2.1 Peek<br>在第一次重按item时触发的操作，会弹出预览框。弹出预览框后，如果这时松手，那么预览框也会随即消失。<br>2.2 Pop<br>Peek操作完成后不松手，再次重按，就可以跳转至详情页了。在跳转至详情页的过程中，我们还可以看到一个轻微的纵向弹性动画。</p>
<p>看完了Peek and Pop 我们就来简单的实现一下吧。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//首先接受代理</span><br><span class="line">@interface ForthTableViewController () &lt;UIViewControllerPreviewingDelegate&gt;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//然后在viewDidLoad里面注册一下registerForPreviewingWithDelegate:sourceView:</span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">[super viewDidLoad];</span><br><span class="line"></span><br><span class="line">//判断是否支持3D Touch，如果支持则需要注册一下</span><br><span class="line">if (self.traitCollection.forceTouchCapability == UIForceTouchCapabilityAvailable) &#123;</span><br><span class="line">[self registerForPreviewingWithDelegate:self sourceView:self.view];</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//实现代理方法</span><br><span class="line">//Peek手势触发，进入预览界面</span><br><span class="line">- (nullable UIViewController *)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext viewControllerForLocation:(CGPoint)location</span><br><span class="line">&#123;</span><br><span class="line">NSIndexPath *indexPath = [self.tableView indexPathForRowAtPoint:location];</span><br><span class="line">UITableViewCell *cell  = [self.tableView cellForRowAtIndexPath:indexPath];</span><br><span class="line">previewingContext.sourceRect = cell.frame;</span><br><span class="line">ThirdViewController *childVC = [[ThirdViewController alloc] init];</span><br><span class="line">UILabel *label      = [[UILabel alloc]init];</span><br><span class="line">label.text          = cell.textLabel.text;</span><br><span class="line">label.textAlignment = NSTextAlignmentCenter;</span><br><span class="line">label.textColor     = [UIColor redColor];</span><br><span class="line">childVC.view        = label;</span><br><span class="line">childVC.view.backgroundColor = [UIColor whiteColor];</span><br><span class="line">childVC.preferredContentSize = CGSizeMake(0.0f,400.0f);</span><br><span class="line"></span><br><span class="line">return childVC;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//Pop手势触发，进入详情界面</span><br><span class="line">- (void)previewingContext:(id &lt;UIViewControllerPreviewing&gt;)previewingContext commitViewController:(UIViewController *)viewControllerToCommit</span><br><span class="line">&#123;</span><br><span class="line">[self showViewController:viewControllerToCommit sender:self];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>代码写到这里，真机运行一下看看效果：<br><img src="/2015/10/29/3d-Touch/20151029155243726.gif"><br>效果看起来还不错~~^_^</p>
<p>接下来我们想起来还有个家伙叫UIPreviewAction，它是Peek预览时上滑底部会出现的菜单。那么该如何添加预览时上滑底部的菜单呢？<br>只需要在我们创建的预览控制器(就是上方的ThirdViewController *childVC)里面重写一下如下这个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray &lt;id &lt;UIPreviewActionItem&gt;&gt; *)previewActionItems &#123;</span><br><span class="line">UIPreviewAction *p1 = [UIPreviewAction actionWithTitle:@&quot;点我!&quot;style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;点击了点我!&quot;);</span><br><span class="line">&#125;];</span><br><span class="line">UIPreviewAction *p2 = [UIPreviewAction actionWithTitle:@&quot;别点我!&quot; style:UIPreviewActionStyleDefault handler:^(UIPreviewAction * _Nonnull action, UIViewController * _Nonnull previewViewController) &#123;</span><br><span class="line"></span><br><span class="line">NSLog(@&quot;点击了别点我!&quot;);</span><br><span class="line">&#125;];</span><br><span class="line">NSArray *actions = @[p1,p2];</span><br><span class="line">return actions;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我写的代码如上所示，然后直接真机跑起来看看效果：<br><img src="/2015/10/29/3d-Touch/20151029160817411.gif"></p>
<hr>
<h2 id="3-UITouch"><a href="#3-UITouch" class="headerlink" title="3. UITouch"></a>3. UITouch</h2><p>UITouch里面多了两个API，分别是力度和最大力度。这个就可以很个性化地做一些酷炫的交互操作了！没啥好说的，touch.force和touch.maximumPossibleForce。大家可以在官方API里面很容易找到他们。看一下就哦了。<br><img src="/2015/10/29/3d-Touch/20151029161500146.jpg"></p>
<hr>
<blockquote>
<p>结束语：刚开始写博客，如有疏漏或者错误之处，欢迎留言指正。</p>
</blockquote>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/iOS/" rel="tag"><i class="fa fa-tag"></i> iOS</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/28/iOS-打包静态库-a文件-入门/" rel="next" title="iOS 打包静态库.a文件--入门">
                <i class="fa fa-chevron-left"></i> iOS 打包静态库.a文件--入门
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2015/12/15/CocoaPods入门-小白篇/" rel="prev" title="CocoaPods入门 --小白篇">
                CocoaPods入门 --小白篇 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zOTY0NS8xNjE3Mg=="></div>
    </div>

  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/myheader.jpg"
                alt="wangkun" />
            
              <p class="site-author-name" itemprop="name">wangkun</p>
              <p class="site-description motion-element" itemprop="description">iOS</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">4</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Home-Screen-Quick-Actions"><span class="nav-text">1. Home  Screen Quick Actions</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#1-1-Static（静态）Quick-Actions"><span class="nav-text">1.1 Static（静态）Quick Actions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-2-Dynamic（动态）-Quick-Actions"><span class="nav-text">1.2 Dynamic（动态） Quick Actions</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#1-3-Actions-被点击后的响应"><span class="nav-text">1.3 Actions 被点击后的响应</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-Peek-and-Pop"><span class="nav-text">2. Peek and Pop</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-UITouch"><span class="nav-text">3. UITouch</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <!-- <i class="fa fa-user"></i> -->
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangkun</span>

  
</div>


<div>
<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<i class="fa fa-user-md"></i>
<span id="busuanzi_container_site_uv" style='display:none'>
    访客数 <span id="busuanzi_value_site_uv"></span>人
    <span class="post-meta-divider">|</span>
</span>
<i class="fa fa-glasses"></i>
<span id="busuanzi_container_site_pv" style='display:none'>
    访问量 <span id="busuanzi_value_site_pv"></span> 次
</span>
</div>


<!-- <div class="powered-by">
<i class="fa fa-user-md"></i>
<span id="busuanzi_container_site_uv">
  访客数:<span id="busuanzi_value_site_uv"></span>
  <span class="post-meta-divider">|</span>
</span>
<i class="fa fa-glasses"></i>
<span id="busuanzi_container_site_pv">
  访问量:<span id="busuanzi_value_site_uv"></span>
</span>
</div> -->

<!-- 

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>



-->

        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>




  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("arycBV0w9fJThzCyvKH3FyTB-gzGzoHsz", "IfNSLpf33vHgnKdqDBQTFqOU");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>

